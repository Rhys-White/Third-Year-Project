!pip install camb
import camb
import numpy as np
from camb import model, initialpower
from astropy.table import Table
from matplotlib import pyplot as plt
from matplotlib import rc

H0_set = np.linspace(50, 90, 5)
H0_set = np.append(H0_set, [67.])

for H0_plot in H0_set:
 pars = camb.set_params(H0=H0_plot, ombh2= 0.02233, omch2= 0.1198, mnu= 0.06, omk= 0, tau= 0.06,
                        As=2.1e-9, ns= 0.965, halofit_version= 'mead', lmax= 6000)
 results = camb.get_results(pars)
 powers = results.get_cmb_power_spectra(pars, CMB_unit='muK')
 all_cls = powers['total']
 ells = np.arange(all_cls.shape[0])
 cl_tt = all_cls[:,0]
 if H0_plot == 67.:
  continue
 else:
  plt.plot(ells, cl_tt, label= f'$H_0 = {H0_plot:.1f}$')

planck = Table.read('COM_PowerSpect_CMB_R2.02.fits', hdu=7)
planck_lowell = Table.read('COM_PowerSpect_CMB_R2.02.fits', hdu=1)
plt.errorbar(planck['ELL'], planck['D_ELL'], yerr=planck['ERR'], fmt='o', markersize=2, capsize=3, color='k', label='\emph{Planck} 2018 Data')
plt.errorbar(planck_lowell['ELL'], planck_lowell['D_ELL'], yerr=[planck_lowell['ERRDOWN'], planck_lowell['ERRUP']], fmt='o', markersize=2, capsize=3, color='k')

plt.legend(fontsize='small')
plt.xscale('log')
plt.yscale('log')
plt.xlabel('$1$')
plt.ylabel('$\mathcal{D}_1$')
plt.xlim([2,6000])
plt.ylim([1.e1, 1.e4])
plt.savefig('./cmb_example_plot.png', dpi=300, bbox_inches='tight')

plt.errorbar(planck['ELL'], planck['D_ELL'], yerr=planck['ERR'], fmt='o', markersize=2, capsize=3, color='k', label='\emph{Planck} 2018 Data')
plt.errorbar(planck_lowell['ELL'], planck_lowell['D_ELL'], yerr=[planck_lowell['ERRDOWN'], planck_lowell['ERRUP']], fmt='o', markersize=2, capsize=3, color='k')

plt.legend(fontsize='small')
plt.xscale('log')
plt.yscale('log')
plt.xlabel('$1$')
plt.ylabel('$\mathcal{D}_1$')
plt.xlim([2,6000])
plt.ylim([1.e1, 1.e4])

fsky= 0.4
mask= np.logical_and(ells >= 40, ells <=6000)
TT_ells, TT_Nell= np.loadtxt("SO_LAT_Nell_T_atmv1_baseline_fsky0p4_ILC_CMB.txt", usecols=(0,1), unpack= True)
TT_Nell = TT_Nell[np.logical_and(ells >= 40, ells <=6000) / (2.7255e6 ** 2)
nltt= np.sqrt(2*(cl_tt[mask]+ TT_Nell)**2 / (fsky*(2*ells[mask]+1)))

plt.errorbar(TT_ells[np.logical_and(TT_ells >= 40, TT_ells <= 6000)], cl_tt[mask], yerr=nltt, fmt='o', markersize=2, capsize=3, color='r', label='baseline', zoreder=-1000)
plt.legend(fontsize='small')
plt.savefig('./cmb_planck_sO.png', dpi=300, bbox_inches='tight')
